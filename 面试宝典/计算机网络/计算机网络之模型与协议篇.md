## **TCP/IP 网络模型有哪几层**

从下到上，分别为：

- 网络接口层，也称链路层：是与物理网络交互的一层，如以太网、WiFi 等，主要负责数据帧的封装与传输
- 网络层：负责数据寻址和路由，对应的核心协议是 IP 协议，确定数据包的传输路径
- 传输层：提供端到端的通信，确保数据的可靠传输，主要协议是 TCP 和 UDP
- 应用层：为用户提供网络服务，直接与应用程序交互，这一层的协议有 FTP、DNS、HTTP 等

<aside> 💡

关键词记忆：

四层：网络接口、网络、传输、应用

协议：IP，TCP, UDP, FTP, DNS, HTTP

功能：物理网络交互、路由寻址、端到端通信、应用服务

思维链：用户 → 应用 → 通信 → 数据传输 → 寻址 → 接口 → 物理网络

</aside>

## 你能说说 OSI 的七层模型吗？

OSI（开放系统互联）模型是一个理论上的网络分层框架，分为七层，从下到上依次是：

1. **物理层（Physical Layer）**：负责比特流的物理传输，涉及硬件设备如网线、光纤、网卡，确保数据在介质上正确传输。
2. **数据链路层（Data Link Layer）**：负责在相邻节点间可靠传输数据帧，处理错误检测和纠正。使用MAC地址进行寻址，典型协议如以太网、PPP。交换机工作在这一层。
3. **网络层（Network Layer）**：负责数据包的路由和转发，决定数据从源到目的的路径。核心协议是IP（IPv4/IPv6），路由器工作在这一层。
4. **传输层（Transport Layer）**：提供端到端的通信服务，确保数据可靠或高效传输。TCP提供可靠、面向连接的服务，UDP提供快速、无连接的服务。
5. **会话层（Session Layer）**：管理设备间的会话，负责建立、维护和终止通信会话。例如，视频会议中保持会话连续性。
6. **表示层（Presentation Layer）**：处理数据的格式化和转换，如加密、解密、压缩、解压缩。确保不同系统间数据格式一致，比如JPEG、SSL。
7. **应用层（Application Layer）**：直接为用户或应用程序提供服务，涉及协议如HTTP、FTP、DNS、SMTP等，处理用户交互数据。

<aside> 💡

关键词记忆：

- 物理层：硬件上的物理传输
- 数据链路层：MAC、数据传输、差错检测
- 网络层：IP、路由、数据包
- 传输层：TCP、UDP、端到端通信
- 会话层：会话管理
- 表示层：数据处理、格式化、加解密、压缩等
- 应用层：HTTP、DNS、用户服务 </aside>

## 你提到了模型中各层的一些协议，你了解这些协议吗？你能具体说说各个协议的功能吗？

将各层的协议列出如下（按 TCP/IP 模型），适当了解它的功能描述，标有颜色的为常问到的协议

1. **网络接口层 (Network Interface Layer)**

该层负责在局域网内通过物理介质传输原始数据，主要处理与硬件相关的通信。

| **协议名称**            | **功能描述**                                                 | **特点与典型应用**                                           |
| ----------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **以太网 (Ethernet)**   | 定义局域网内数据帧的格式、传输速率及物理介质标准，使用 MAC 地址进行设备寻址。 | 最常见的有线局域网技术，支持星型、总线型拓扑结构，广泛用于家庭、企业网络。 |
| **Wi-Fi (IEEE 802.11)** | 无线局域网标准，通过无线电波传输数据，使用 MAC 地址寻址。    | 提供灵活的设备接入方式，适用于移动设备、智能家居等无线环境。 |
| **ARP (地址解析协议)**  | 将网络层的 IP 地址解析为数据链路层的 MAC 地址，实现局域网内设备间的直接通信。 | 通过广播请求和单播响应完成地址解析，维护 ARP 缓存表提高效率。 |
| **PPP (点对点协议)**    | 用于直接连接两个节点的数据传输，常见于拨号上网、VPN 等场景。 | 支持身份验证、数据压缩和加密，适用于串行链路通信。           |

1. **网络层 (Network Layer)**

该层负责在不同网络之间寻址和路由数据包，确保数据能够跨网络传输。

| **协议名称**                 | **功能描述**                                                 | **特点与典型应用**                                           |
| ---------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **IP (网际协议, IPv4/IPv6)** | 为数据包添加源和目标 IP 地址，实现跨网络的路由和转发。IPv4 使用 32 位地址，IPv6 使用 128 位地址。 | IPv4 地址稀缺，需 NAT 辅助；IPv6 地址空间巨大，支持更高效路由和安全特性。 |
| **ICMP (网际控制消息协议)**  | 用于传输网络状态和控制信息，如错误报告、网络连通性测试。     | `ping` 和 `tracert` 命令基于 ICMP，帮助诊断网络故障。        |
| **IGMP (组管理协议)**        | 管理 IP 多播组成员，控制多播数据的传输范围。                 | 适用于视频会议、在线直播等多播场景。                         |
| **IPsec (IP安全协议)**       | 为 IP 层提供加密、认证和完整性保护，增强数据传输安全性。     | 常用于 VPN 连接，保护数据在公共网络上的传输。                |

1. **传输层 (Transport Layer)**

该层负责端到端的通信控制，确保数据可靠传输或高效传输。

| **协议名称**             | **功能描述**                                                 | **特点与典型应用**                                           |
| ------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **TCP (传输控制协议)**   | 面向连接的可靠传输协议，通过三次握手建立连接、确认机制和重传策略保证数据有序、无差错、不丢失。 | 适用于要求可靠性的场景，如网页浏览（HTTP/S）、文件传输（FTP）、电子邮件（SMTP）等。 |
| **UDP (用户数据报协议)** | 无连接的不可靠传输协议，不保证数据顺序和可达性，但开销小、延迟低。 | 适用于实时性要求高的场景，如视频流（RTP）、语音通话（VoIP）、在线游戏等。 |

1. **应用层 (Application Layer)**

该层直接为应用程序提供网络服务，定义数据格式和会话规则。

| **协议名称**                | **功能描述**                                                 | **特点与典型应用**                                           |
| --------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **HTTP/HTTPS**              | 超文本传输协议，用于客户端和服务器之间的网页数据传输。HTTPS 通过 TLS/SSL 加密保障安全。 | HTTP 默认端口 80，HTTPS 默认端口 443。广泛应用于 Web 服务、API 交互等。 |
| **DNS (域名系统)**          | 将人类可读的域名解析为 IP 地址，实现互联网资源的寻址。       | 采用分布式数据库结构，支持递归查询和缓存机制，端口 53。      |
| **FTP/FTPS/SFTP**           | 文件传输协议，用于客户端和服务器之间的文件上传和下载。FTPS 是 FTP over SSL，SFTP 是 SSH 文件传输协议。 | FTP 端口 21（控制）和 20（数据），SFTP 端口 22。适用于大文件传输和服务器管理。 |
| **SMTP**                    | 简单邮件传输协议，负责电子邮件的发送和中转。                 | 默认端口 25，使用 ASCII 编码传输邮件内容和附件。             |
| **POP3/IMAP**               | 邮局协议和互联网消息访问协议，用于从服务器接收邮件。POP3 下载到本地，IMAP 在服务器管理。 | POP3 端口 110，IMAP 端口 143。支持加密版本（POP3S/IMAPS）。  |
| **SSH (安全外壳协议)**      | 通过加密通道远程登录和管理设备，替代不安全的 Telnet。        | 端口 22，支持身份验证、数据加密和端口转发。                  |
| **DHCP (动态主机配置协议)** | 自动为网络设备分配 IP 地址、子网掩码、网关等参数，简化网络管理。 | 采用客户端-服务器模型，支持地址租期和续约。                  |

## OSI模型与TCP/IP模型的具体差异是什么？

总体结论上来说：OSI 是理想化的理论框架，TCP/IP 是工程上落地的实现模型

- 层级数量：（如果直接是这个问题，就按上面的答案说说两个模型都有什么层）强调 OSI 每层的功能分离，更加细化和标准化，而TCP/IP模型更实用
- 设计理念：OSI模型是先设计模型再开发协议，理论性强，适用于各种网络协议的描述，但实现复杂。TCP/IP模型先有协议再总结模型，更加务实，广泛应用于互联网。
- 功能划分：
  - OSI的物理层和数据链路层在TCP/IP中合并为网络接口层，TCP/IP对底层硬件细节不做严格定义。
  - OSI的会话层和表示层（如数据加密、格式转换）在TCP/IP中由应用层协议（如HTTP、TLS）处理。

## 请你说说键入网址到网页显示的期间发生了什么

期间主要发生的流程是：

1. URL 解析：通过用户输入的网址，提取出协议（如 https）、主机名、端口号等信息
2. DNS 解析：将主机名解析为 IP 地址，然后通过 DNS 查询找到目标服务器
3. 建立 TCP 连接：通过 TCP 三次握手与服务器建立连接，如果是 https 还会在 TCP 之上进行 TLS 握手，完成证书验证，通信安全更高级
4. 发送 HTTP 请求：连接建立后，浏览器会构造请求报文，包括一些请求方法（post/get 等）、请求头、请求体等，发送给服务器
5. 服务器处理：根据请求，进行一些业务逻辑的处理，然后生成响应
6. 返回响应：服务器将响应报文返回，包括状态码、响应头和响应体，可能包含有 HTML文件、CSS、JS等资源
7. 浏览器渲染：浏览器接收响应后，进入渲染流程

<aside> 💡

关键词记忆：

思维链：解析（url、dns）→ 建立连接（tcp）→ 发送请求（http）→ 服务器处理 → 返回响应 → 浏览器渲染

</aside>

## 请你讲讲你对 IP 地址的认识

- 作用：IP地址用于在网络中唯一标识一台设备，确保数据包能够准确发送到目标设备。它在网络层负责寻址和路由，是互联网通信的核心。
- 分类：IP地址主要分为IPv4和IPv6两种版本：
  - IPv4：32位地址，通常以点分十进制表示（如192.168.1.1），共约43亿个地址。由于地址空间有限，IPv4面临耗尽问题。
  - IPv6：128位地址，用冒号分隔的十六进制表示（如2001:0db8::1），地址空间几乎无限，解决了IPv4的不足，并支持更多功能（如自动配置）。
- 类型：IP地址分为公网地址和私网地址
  - 公网地址：在互联网上全局唯一，可以被直接路由和访问。任何一台想要直接连接互联网的设备都必须有一个公网IP。这部分地址由IANA等机构统一分配和管理，是稀缺资源。
  - 私网地址：在私有网络（如家庭、企业局域网）内部使用的地址段。这些地址不能在互联网上被路由，因此可以在不同局域网中重复使用。设备通过NAT（网络地址转换） 技术，共享一个公网IP来访问互联网。
- 地址结构：IPv4 最初分 A/B/C/D/E 类网络，后来用 CIDR 代替按需分配，更灵活。

### 扩展1：更具体的说说 IP 地址分类与无分类地址 CIDR

- 最初，IPv4地址采用

  有类编址

  ，根据前几位比特划分为A、B、C、D、E五类。这种划分方式非常不灵活，导致了地址的大量浪费。

  - **A类** (0...)：大型网络，网络号占8位，主机号占24位（约1600万台主机）
  - **B类** (10...)：中型网络，网络号占16位，主机号占16位（约6.5万台主机）
  - **C类** (110...)：小型网络，网络号占24位，主机号占8位（254台主机）
  - **D类** (1110)：组播地址
  - **E类** (1111)：保留地址

- 为了解决有类编址的低效问题，现在普遍采用

  无类编址（CIDR，Classless Inter-Domain Routing）

  。

  - 它打破了A、B、C类的固定边界，允许按需分配任意大小的网络块，提高了地址利用率和路由聚合效率。
  - 与CIDR配套使用的是**子网划分**技术，允许将一个大的网络块进一步划分成多个更小的子网，以适应内部网络规划。通过**子网掩码**（与网络前缀位数对应，如/24的掩码是255.255.255.0）来区分一个IP地址中的网络部分和主机部分。

### 扩展2：CIDR 怎么划分网络号和主机号？

它通过 **“IP 地址/前缀长度”** 的方式来灵活划分网络号和主机号。

<aside> 💡

划分方法示例：

**`/`后面的数字（网络前缀位数）直接指明了网络号的长度。**

这个数字表示IP地址32位二进制数中，从左向右数，有多少位属于网络号，剩下的部分就是主机号。

拿到一个CIDR地址，比如 `192.168.1.130/25`。

**第一步：** 把IP地址和网络前缀位数都转换为二进制。

```
192.168.1.130` 的二进制是 `11000000.10101000.00000001.10000010
```

`/25` 意味着前25位是网络号。

- 11000000.10101000.00000001.10000000 是网络号
  - 为什么是 10000000，减去后 7 位记得补上 0
- 0000010 是主机号

所以，对于这个IP，它的**网络号**就是前25位二进制所对应的网段，通常用网络地址表示 `192.168.1.128`

</aside>

CIDR 的关键就是 **前缀长度决定网络号位数**，剩余位数就是主机号，公式是：可用主机数 = `2^(主机位数) - 2`

### 扩展3：广播地址和多播地址

在 IP 网络中，除了单播（点对点）地址，还有 **广播地址和多播地址。**

广播面向子网内所有主机（一个网段中最大的IP地址，即主机位全部为 `1`），只能在本地网段内传播，路由器默认会隔离和丢弃广播包，防止它扩散到整个互联网，这就是“广播域”的概念。常用于ARP（地址解析协议）、DHCP（动态主机配置协议）等需要在本地网络中发现服务或设备的场景。

- 例如，在 `192.168.1.0/24` 网段中，广播地址是 `192.168.1.255`。发送到这个地址的数据，该网段内所有主机都会接收并处理。

而多播是面向某一组主机，这些设备可能分布在网络中的任何地方。（加入特定**多播组**的设备，是一种“自愿加入”的组播通信。只有感兴趣并主动加入的设备才会接收和处理。）可以跨越路由器，通过支持多播的路由协议（如PIM）在互联网上进行传输。非常适合一对多的流媒体应用，如**视频会议、在线直播、股票信息推送、软件分发**等。它效率远高于广播，因为不会打扰非组内成员，也比用单播分别发送给每个接收者更节省带宽。

- 例如，使用D类IP地址段 `224.0.0.0` 到 `239.255.255.255`。

这两种方式都是为了提高效率，区别在于广播“全网推送”，而多播是“按组推送”。

<aside> 💡

**核心区别总结：**

| **特性**     | **广播地址**                     | **多播地址**                     |
| ------------ | -------------------------------- | -------------------------------- |
| **目标对象** | 一个网段内的**所有**设备         | 加入特定组的**部分**设备         |
| **通信范围** | 局限在本地广播域，**不过路由器** | 可以跨越路由器，**遍及整个网络** |
| **网络影响** | 效率低，浪费资源，有安全风险     | 效率高，节省网络带宽             |
| **地址范围** | 每个网段有自己的广播地址         | 固定的D类地址段 (`224.0.0.0/4`)  |

更抽象的理解，**广播是“对本地所有人喊话”**，而**多播是“对一个俱乐部里的所有会员通知”**，会员可以分布在各地。

</aside>

### 扩展4：说说子网划分技术和子网掩码

先说说子网掩码。

子网掩码是一个**32位的二进制数**，用于**区分一个IP地址中哪部分是网络号，哪部分是主机号**。

它由连续的 `1` 和连续的 `0` 组成。`1` 的部分对应网络号和子网号，`0` 的部分对应主机号。有两种表示法：

- **点分十进制**：如 `255.255.255.0`（对应 `/24`）。
- **CIDR前缀表示法**：更简洁，直接在IP地址后加上`/网络位长度`，如 `192.168.1.0/24`。

当一台设备要发送数据时，它会用自己的子网掩码和目的IP地址做“逻辑与”运算，得到一个网络地址。再将这个结果与自己的网络地址比较，来判断目的设备是否在同一网段内，从而决定是直接交付还是发送给网关。

<aside> 💡

来个更通俗易懂的解释：子网掩码其实是个 “划分规则”，目的是告诉我们：一个 IP 地址里，哪些数字代表 “大区域”（网络部分），哪些代表 “小个体”（主机部分）。

而掩码，则是一种”规则“，比如，IP 地址是 “192.168.1.5”，我们可以用一个 “掩码” 来规定：“IP 地址的前 3 段（192.168.1）代表子网，最后 1 段（5）代表子网里的具体电脑”。

用生活中的例子来举例，假设 IP 地址是 “北京市海淀区中关村大街 100 号”，子网掩码就像一个规则：“前 3 个词（北京市海淀区）是大区域，后面的（中关村大街 100 号）是具体地址”。

那为什么需要子网掩码呢？

就好比一个网络里面设备太多，通信会非常混乱。子网掩码可以将大网络拆分成小网络，比如广东省这个大网络，分为广东省广州市、广东省深圳市…，让同一子网内的设备高效通信，不同子网的设备通过网关沟通，避免混乱，提高通信效率。

</aside>

子网划分是指将一个大的IP网络（A、B、C类网或一个CIDR地址块）分割成多个更小的、可管理的子网络的过程。

原理是通过借用IP地址的主机位作为子网位，创建多个子网。例如，一个/24网络（192.168.1.0/24）可以借用2位主机位，划分为4个/26子网（192.168.1.0/26、192.168.1.64/26等）。

- 子网数量 = 2^n（n 是借的子网位数）。比如借 1 位，能分 2 个子网；借 2 位，能分 4 个子网，以此类推。
- 每个子网的最大主机数 = 2^m - 2（m 是剩余的主机位数，减 2 是去掉 “网络地址” 和 “广播地址”，这两个地址不能给设备用）。